<section class="activity-page">
  <h1 class="activity-page__title">Activity Log</h1>

  @if (!usingApi) {
  <p class="activity-page__api-disabled">API is disabled, so no activities can be shown.</p>
  } @else {
  <div class="activity-list">
    <div class="activity-list__header" [class.debug-mode]="cfg.debug">
      <div class="activity-list__header-cell">When</div>
      <div class="activity-list__header-cell">Action</div>
      <div class="activity-list__header-cell">By</div>
      @if (cfg.debug) {
      <div class="activity-list__header-cell">Entity</div>
      }
      <div class="activity-list__header-cell">Details</div>
    </div>

    @for (a of items(); track a.id) {
    <div class="activity-item" [class.debug-mode]="cfg.debug">
      <div class="activity-item__cell">{{ a.created_at | date:'short' }}</div>
      <div class="activity-item__cell">{{ friendlyAction(a) }}</div>
      <div class="activity-item__cell">{{ actorName(a) }}</div>
      @if (cfg.debug) {
      <div class="activity-item__cell">
        <button ngpButton type="button" (click)="toggleRaw(a.id)">
          {{ rawOpen(a.id) ? 'Hide' : 'Show' }} Raw
        </button>
      </div>
      }
      <div class="activity-item__cell">
        @if (rawOpen(a.id)) {
        <pre class="activity-item__payload">{{ a.payload | json }}</pre>
        } @else {
        @if ($any(a.payload)?.total != null) {
        <span class="activity-item__value">{{ $any(a.payload).total | currency:'EUR':'symbol':'1.2-2' }}</span>
        } @else if ($any(a.payload)?.name) {
        <span class="activity-item__value">{{ $any(a.payload).name }}</span>
        } @else {
        <span class="activity-item__no-details">â€”</span>
        }
        }
      </div>
    </div>
    }

    @if (items().length === 0) {
    <div class="activity-list__empty">
      <p>No activities recorded yet.</p>
    </div>
    }
  </div>

  @if (total() > pageSize) {
  <div class="pagination">
    <button ngpButton (click)="loadPage(page() - 1)" [disabled]="page() <= 1">Prev</button>
    <span class="pagination__page-number">Page {{ page() }} of {{ totalPages() }}</span>
    <button ngpButton (click)="loadPage(page() + 1)" [disabled]="page() * pageSize >= total()">Next</button>
  </div>
  }
  }
</section>
