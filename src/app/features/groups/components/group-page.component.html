<section class="budget__section card card--glass">
  <h2>Group</h2>
  <p class="text text--muted">People in your expense-split group.</p>

  <!-- Split summary -->
  <div class="chip-group" aria-label="Split by income" style="margin-bottom:8px;">
    @for (m of members(); track m.id) {
    <span class="chip">{{ m.name }}: {{ (shareById()[m.id] || 0) * 100 | number:'1.0-2' }}%</span>
    }
  </div>

  @if (accessDenied()) {
  <div class="card card--glass" style="margin-bottom:12px;">
    <p class="text">You don't have access to this group yet. Paste your invite token to accept.</p>
    <div style="display:flex; gap:8px; align-items:center;">
      <input class="input" placeholder="Invite token" [value]="acceptTokenValue()"
        (input)="acceptTokenValue.set($any($event.target).value)" />
      <button class="button button--success button--sm" (click)="acceptToken()">Accept invite</button>
    </div>
  </div>
  }

  <div style="display:flex; gap:8px; align-items:center; margin: 8px 0; flex-wrap: wrap;">
    <input class="input" placeholder="Invite emails (comma or space separated)" [value]="inviteEmails()"
      (input)="inviteEmails.set($any($event.target).value)" [disabled]="!isOwner()" />
    <button class="button button--sm" (click)="sendInvites()" [disabled]="!isOwner()">Invite</button>
  </div>
  <div class="data-table" role="table" aria-label="Group list">
    <div class="data-table__head" role="rowgroup">
      <div class="data-table__row group-grid" role="row">
        <div class="data-table__cell data-table__cell--head" role="columnheader">Name</div>
        <div class="data-table__cell data-table__cell--head" role="columnheader">Email</div>
        <div class="data-table__cell data-table__cell--head data-table__cell--num" role="columnheader">Percent</div>
        <div class="data-table__cell data-table__cell--head" role="columnheader">Status</div>
      </div>
    </div>
    <div class="data-table__body" role="rowgroup">
      @for (m of members(); track m.id) {
      <div class="data-table__row group-grid" role="row">
        <div class="data-table__cell">{{ m.name }}</div>
        <div class="data-table__cell">{{ m.email || 'â€”' }}</div>
        <div class="data-table__cell data-table__cell--num">{{ (shareById()[m.id] || 0) * 100 | number:'1.0-2' }}%</div>
        <div class="data-table__cell">
          <span class="chip" [class.u-bold]="m.accepted">{{ m.accepted ? 'accepted' : 'pending' }}</span>
        </div>
      </div>
      }
      @if (members().length === 0) {
      <div class="data-table__row data-table__row--empty">
        <div class="data-table__cell">No members yet.</div>
      </div>
      }
    </div>
  </div>
  @if (lastInvites().length) {
  <div class="card card--glass" style="margin-top:12px;">
    <h3>Share these invite links</h3>
    <ul class="text">
      @for (i of lastInvites(); track i.token) {
      <li>
        {{ i.email }}:
        <code>{{ (typeof window !== 'undefined' ? window.location.origin : '') + '/invite/' + i.token }}</code>
      </li>
      }
    </ul>
    <p class="text text--muted">Send these links manually. Only the owner of the invited email can accept.</p>
  </div>
  }

  <div class="data-table" role="table" aria-label="Pending invites" style="margin-top:12px;">
    <div class="data-table__head" role="rowgroup">
      <div class="data-table__row" role="row" style="grid-template-columns: 2fr 2fr 160px;">
        <div class="data-table__cell data-table__cell--head" role="columnheader">Email</div>
        <div class="data-table__cell data-table__cell--head" role="columnheader">Link</div>
        <div class="data-table__cell data-table__cell--head" role="columnheader"></div>
      </div>
    </div>
    <div class="data-table__body" role="rowgroup">
      @for (i of pendingInvites(); track i.id) {
      <div class="data-table__row" role="row" style="grid-template-columns: 2fr 2fr 160px;">
        <div class="data-table__cell">{{ i.email }}</div>
        <div class="data-table__cell">
          @if (isOwner()) {
          <code>{{ (typeof window !== 'undefined' ? window.location.origin : '') + '/invite/' + i.token }}</code>
          } @else {
          <span class="text text--muted">(Invite pending)</span>
          }
        </div>
        <div class="data-table__cell data-table__cell--actions">
          @if (isOwner()) {
          <button class="button button--sm" (click)="resend(i.id)" [disabled]="!isOwner()">Resend</button>
          <button class="button button--danger-ghost button--sm" (click)="revoke(i.id)"
            [disabled]="!isOwner()">Revoke</button>
          } @else {
          <button class="button button--sm" (click)="acceptInvite(i.id)">Accept</button>
          <button class="button button--danger-ghost button--sm" (click)="rejectInvite(i.id)">Reject</button>
          }
        </div>
      </div>
      }
      @if (pendingInvites().length === 0) {
      <div class="data-table__row data-table__row--empty">
        <div class="data-table__cell">No pending invites.</div>
      </div>
      }
    </div>
  </div>
</section>
